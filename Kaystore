Build Android AAB
name: Build Android AAB

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: â¬‡ï¸ Cloner le dÃ©pÃ´t
        uses: actions/checkout@v3

      - name: ðŸ§° Installer Node.js, Yarn & Expo
        uses: expo/expo-github-action@v8
        with:
          expo-version: latest
          token: ${{ secrets.EXPO_TOKEN }}

      - name: ðŸ“ CrÃ©er le fichier keystore
        run: |
          echo "${{ secrets.ANDROID_KEYSTORE_BASE64 }}" | base64 --decode > my-release-key.keystore

      - name: ðŸ› ï¸ Configurer credentials.json
        run: |
          mkdir -p android
          echo '{
            "android": {
              "keystore": {
                "dataBase64": "${{ secrets.ANDROID_KEYSTORE_BASE64 }}",
                "keystorePassword": "${{ secrets.KEYSTORE_PASSWORD }}",
                "keyAlias": "${{ secrets.KEY_ALIAS }}",
                "keyPassword": "${{ secrets.KEY_PASSWORD }}"
              }
            }
          }' > credentials.json

      - name: ðŸš€ Build .aab avec EAS
        run: |
          npx eas-cli build --platform android --profile production --non-interactive --local

      - name: ðŸ“¦ Upload de lâ€™AAB
        uses: actions/upload-artifact@v4
        with:
          name: afrikoin-aab
          path: dist/*.aab
